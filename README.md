# hc_telebot

Перед вами бот для МГ, сделанный для игры "Хогвартские сезоны" по запросу ОТ.

# Параметры
Бот работает с базой в гугл доке, где проходит общая работа со всеми обращениями в ОТ.

База имеет три вкладки:

* Регистрация - список пользователей зарегистрированных или пытавшихся
* Запросы - список заявок от игроков
* allrpg - выгрузка базы по контактам игроков, используется для регистрации

Последовательность вкладок строго только такая! Вкладки могу быть пустыми, но должны быть созданы для работы.

Перед запуском необходимо заполнить файл - settengs_bot.py согласно комментариям.

Зарегистрировать своего бота можно в https://t.me/BotFather Он выдает токен.

Если не знаете ИД чата, то добавьте бота в чат и посмотрите консоль в случае прописания команды /start там будет указан ИД Чата, либо используйте многочисленные гайды.

Самый неоднозначный этап это аккаунт разработчика гугла, который потребуется для использования гугл дока как базы для бота.

Инструкция как зарегистироваться и получить свой json есть здесь - https://developers.google.com/workspace/guides/create-credentials?hl=ru

Важно! Для работы ваш json файл аккаунта разработчика должен находиться в корневой папке бота, а разработческий адрес должен быть добавлен как администратор в документ, вкладки для которого указывались ранее.

Если нужно чтобы бот уведомлял чаще или реже меняем параметр check_time.

## Запуск
Для работы должны быть одновременно запущенны два файла:
* main_bot
* bot_back
Запуск необходимо производить в разных терминалах. 
Первый файл это непосредственно сам бот. Второй это планировщик, который оповещает МГ о новых заявках и пишет ответы пользователям.

Разделение сделано для синхронного режима ответа. Вне зависимости от новой информации пользователи все равно будут оповещены и наоборот. То что бот пишет пользователю ответ не сразу, часть изначального задания от ОТ.

## Регистрация
Пока пользователь не пройдет регистрацию его не пускает к основным функциям бота. Сама регистрация проходится автоматически, для регистрации телеграм пользователя должен быть указан на вкладке allrpg в любом месте, но точно также как он указан в самом телеграм, с учетом регистра, если пользователь не создал себе ник, то ему нужно это сделать.

ВАЖНО! Для бана пользователя нужно удалить его телеграм с вкладки allrpg и с вкладки регистрация.
Если пользователь есть в базе, то при первом входе он добавится на вкладку “Регистрация” и в дальнейшем будет сразу иметь доступ к основному меню.

## Новая заявка
Для новой заявки пользователь нажимает соответствующую кнопку в боте и вводит запрос, он попадает новой строкой в гугл таблицу вкладку  Запросы, ему присваивается номер, который записывается в первую колонку и указывает пользователю.
Колонка время создания это время создания. Колонка время уточнения в отличии от неё обновляется каждый раз при уточнении запроса.

## Ответ на заявку
Для ответа на заявку нужно заполнить текст в колонке “Ответ” и после поставить “1” в колонке “Отправить ответ?”. Бот ответит пользователю в течение 10 минут, в зависимости от такта. Для повторного ответа нужно сделать пустой ячейку “Ответ отправлен!” тогда при следующем такте бот напишет сообщение пользователю указанное в колонке “Ответ”.

## Уточнение по заявке
Уточнения игрока заполняются в поле “Уточнение игрока” игрок может отправить сколько угодно уточнений, но только до тех пор пока по его запросу нет ответа.

## Открытые заявки
Здесь пользователь может посмотреть текст запросов, которые оставил и по которым ОТ ещё не дал ответа.


## Используемые библиотеки

* time
* datetime
* requests
* bs4
* telebot
* pandas
* httplib2
* apiclient
* oauth2client
* gspread
* urllib3